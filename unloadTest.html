<!DOCTYPE html>
<html>
<script type="text/javascript">
    "use strict";
    
    window.onbeforeunload = function (e) {
        console.log("beforeunload start!!");
        var client = new XMLHttpRequest();
        client.open("GET", "foo.txt#" + Math.floor(100000000 + Math.random() * 900000000), false); // third parameter indicates sync xhr
        client.setRequestHeader("Content-Type", "text/plain;charset=UTF-8");
        client.send();
        console.log("beforeunload end!!");
        e.returnValue = "";
        return "";
    }
    
    /*
    window.addEventListener("beforeunload", function (e) {
        console.log("beforeunload start!!0");
        
        console.log("beforeunload end!!0");
    });
    
    window.addEventListener("beforeunload", function (e) {
        console.log("beforeunload start!!1");
        var client = new XMLHttpRequest();
        client.open("GET", "foo.txt#" + Math.floor(100000000 + Math.random() * 900000000), false); // third parameter indicates sync xhr
        client.setRequestHeader("Content-Type", "text/plain;charset=UTF-8");
        client.send();
        console.log("beforeunload end!!1");
        e.returnValue = "";
        return "";
    });
    */
    
    window.onunload = function () {
        console.log("unload start!!");
        var client = new XMLHttpRequest();
        client.open("GET", "foo.txt#" + Math.floor(100000000 + Math.random() * 900000000), false); // third parameter indicates sync xhr
        client.setRequestHeader("Content-Type", "text/plain;charset=UTF-8");
        client.send();
        console.log("unload end!!");
    }
</script>
<body>
<h1>This page requests the foo.txt file when unload event occurs.</h1>
</body>
</html>
